{% extends 'base.html' %}
{% load static %}

{% block title %}イベントカレンダー{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="{% static 'events/css/calendar.css' %}" />
{% endblock %}

{% block content %}
<div class="calendar-container">
  <div class="month-navigation">
    <button class="month-nav-btn" id="prevMonthBtn">前月</button>
    <div class="current-month" id="currentMonth">2024年1月</div>
    <button class="month-nav-btn" id="nextMonthBtn">次月</button>
  </div>

  <div class="filter-section">
    <form method="get" class="filter-form">
      <label class="checkbox-label">
        <input type="checkbox" name="show_deleted" value="true" 
               {% if show_deleted %}checked{% endif %} 
               onchange="this.form.submit()">
        <span class="checkmark"></span>
        削除されたイベントも表示
      </label>
    </form>
  </div>

  <div class="calendar-grid">
    <div class="calendar-day-header">日</div>
    <div class="calendar-day-header">月</div>
    <div class="calendar-day-header">火</div>
    <div class="calendar-day-header">水</div>
    <div class="calendar-day-header">木</div>
    <div class="calendar-day-header">金</div>
    <div class="calendar-day-header">土</div>

    <div id="calendarDays"></div>
  </div>
</div>

<!-- Djangoテンプレートからイベントデータを取得 -->
<!-- prettier-ignore -->
<script>
    const eventData = [
        {% for event in events %}
        {
            id: {{ event.id }},
            title: "{{ event.title|escapejs }}",
            start_time: new Date("{{ event.start_time|date:'Y-m-d H:i:s' }}"),
            end_time: new Date("{{ event.end_time|date:'Y-m-d H:i:s' }}"),
            location: "{{ event.location|escapejs }}",
            description: "{{ event.description|escapejs }}"
        }{% if not forloop.last %},{% endif %}
        {% endfor %}
    ];

    // デバッグ用：イベントデータの確認
    console.log('Event data loaded:', eventData);
</script>
{% endblock %}

{% block extra_js %}
<!-- 外部JavaScriptファイルを読み込み -->
<script src="{% static 'events/js/calendar.js' %}"></script>

<!-- デバッグ用のテスト -->
<script>
  console.log('HTML loaded');
  console.log('Static files loaded');
  console.log('Event data:', eventData);

  // 簡単なテスト
  setTimeout(() => {
    if (typeof renderCalendar === 'function') {
      console.log('renderCalendar function found');
    } else {
      console.log('renderCalendar function NOT found');
    }
  }, 1000);
</script>
{% endblock %}
